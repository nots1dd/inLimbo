# inLimbo Build Guide

This document explains how to build, test, format, and maintain the **inLimbo** project using the provided **Makefile**.
The Makefile is a thin, explicit wrapper around **CMake**, intended to standardize common workflows.

## Requirements

Before building, ensure the following tools are available:

> [!NOTE]
> 
> Although my CMake build process allows version `3.5` onwards,
> it is **NOT** tested and is recommended to have the latest
> possible version as per your distro.
> 

* CMake (3.16 or newer recommended)
* CTest (comes with CMake) [IGNORE]
* A C++20-compatible compiler (clang or gcc)
* make
* clang-format (for formatting)
* clang-tidy (for static analysis)
* Git (for submodules)

You can verify required tools using:

```bash
make verify-deps
```

If dependencies are missing, the Makefile provides a helper to install them using your system package manager:

```bash
make install-deps
```

Supported distributions:

* Arch Linux
* Debian / Ubuntu
* Fedora

## Build Overview

The project supports **Release** and **Debug** builds, each in its own build directory:

* Release build: `build/`
* Debug build: `build-dbg/`

The Makefile separates **configuration** (CMake generation) from **building**.

## Building the Project

### Release build (recommended)

#### First-time build (configure + build)

```bash
make buildx
```

This runs:

```bash
cmake -S . -B build
cmake --build build
```

#### Incremental build (after initial configuration)

```bash
make build
```

This only runs:

```bash
cmake --build build
```

### Debug build

#### First-time debug build

```bash
make buildx-dbg
```

This runs:

```bash
cmake -S . -B build-dbg -D CMAKE_BUILD_TYPE=Debug
cmake --build build-dbg
```

#### Incremental debug build

```bash
make build-dbg
```

### Rebuilding from scratch

To remove all build artifacts and rebuild:

```bash
make rebuild
```

For debug builds:

```bash
make rebuild-dbg
```

## Running Tests

Tests are built and executed using **GoogleTest** and **CTest**.

### Run tests (Release build)

```bash
make test
```

Equivalent to:

```bash
ctest --test-dir build --output-on-failure
```

### Run tests (Debug build)

```bash
make test-dbg
```

Equivalent to:

```bash
ctest --test-dir build-dbg --output-on-failure
```

## Formatting and Static Analysis

### Format all source files

Applies `clang-format` in-place to all source and header files:

```bash
make fmt
```

### Check formatting without modifying files

Useful for CI:

```bash
make fmt-check
```

### Run clang-tidy

Requires `compile_commands.json` (generated by CMake):

```bash
make tidy
```

If the compilation database is missing, configure CMake with:

```bash
cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -B build
```

## Git Submodules

### Check submodule status

```bash
make submod-check
```

### Initialize submodules

```bash
make submod-init
```

## Cleaning Build Artifacts

To remove all build directories:

```bash
make clean
```

This deletes:

* `build/`
* `build-dbg/`

## Project Statistics

To display basic project metrics:

```bash
make stats
```

This prints the number of source files, header files, and total files.

## Run All Checks

For a full local verification (useful before pushing changes):

```bash
make all-checks
```

This runs:

* dependency verification
* formatting checks
* clang-tidy analysis

## Help

To list all available Makefile targets:

```bash
make help
```

## Recommended Workflow

For day-to-day development:

```bash
make buildx        # first time
make build         # incremental builds
make test          # run tests
make fmt           # format code
```

For debugging:

```bash
make buildx-dbg
make test-dbg
```

## Notes

* The Makefile does not replace CMake; it standardizes common commands.
* Build directories are kept out-of-tree to avoid polluting the source tree.
* Release and Debug builds are completely isolated.
* All targets are explicit; no implicit behavior is hidden.
