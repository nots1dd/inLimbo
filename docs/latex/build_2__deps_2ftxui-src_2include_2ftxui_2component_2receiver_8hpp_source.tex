\doxysection{receiver.\+hpp}
\hypertarget{build_2__deps_2ftxui-src_2include_2ftxui_2component_2receiver_8hpp_source}{}\label{build_2__deps_2ftxui-src_2include_2ftxui_2component_2receiver_8hpp_source}\index{build/\_deps/ftxui-\/src/include/ftxui/component/receiver.hpp@{build/\_deps/ftxui-\/src/include/ftxui/component/receiver.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ 2020\ Arthur\ Sonzogni.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Use\ of\ this\ source\ code\ is\ governed\ by\ the\ MIT\ license\ that\ can\ be\ found\ in}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ the\ LICENSE\ file.}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#ifndef\ FTXUI\_COMPONENT\_RECEIVER\_HPP\_}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ FTXUI\_COMPONENT\_RECEIVER\_HPP\_}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <algorithm>}\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ copy,\ max}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <atomic>}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ atomic,\ \_\_atomic\_base}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <condition\_variable>}\ \ \textcolor{comment}{//\ for\ condition\_variable}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <memory>}\ \ \ \textcolor{comment}{//\ for\ unique\_ptr,\ make\_unique}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <mutex>}\ \ \ \ \textcolor{comment}{//\ for\ mutex,\ unique\_lock}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <queue>}\ \ \ \ \textcolor{comment}{//\ for\ queue}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <utility>}\ \ \textcolor{comment}{//\ for\ move}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }ftxui\ \{}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{comment}{//\ Usage:}}
\DoxyCodeLine{00020\ \textcolor{comment}{//}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ Initialization:}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00023\ \textcolor{comment}{//}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ auto\ receiver\ =\ MakeReceiver<std:string>();}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ auto\ sender\_1=\ receiver-\/>MakeSender();}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ auto\ sender\_2\ =\ receiver-\/>MakeSender();}}
\DoxyCodeLine{00027\ \textcolor{comment}{//}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ Then\ move\ the\ senders\ elsewhere,\ potentially\ in\ a\ different\ thread.}}
\DoxyCodeLine{00029\ \textcolor{comment}{//}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ On\ the\ producer\ side:}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ [thread\ 1]\ sender\_1-\/>Send("{}hello"{});}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ [thread\ 2]\ sender\_2-\/>Send("{}world"{});}}
\DoxyCodeLine{00034\ \textcolor{comment}{//}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ On\ the\ consumer\ side:}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ char\ c;}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ while(receiver-\/>Receive(\&c))\ //\ Return\ true\ as\ long\ as\ there\ is\ a\ producer.}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ \ \ print(c)}}
\DoxyCodeLine{00040\ \textcolor{comment}{//}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ Receiver::Receive()\ returns\ true\ when\ there\ are\ no\ more\ senders.}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{00044\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classftxui_1_1SenderImpl}{SenderImpl}};}
\DoxyCodeLine{00045\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classftxui_1_1ReceiverImpl}{ReceiverImpl}};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{using\ }Sender\ =\ std::unique\_ptr<SenderImpl<T>>;}
\DoxyCodeLine{00048\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>\ \textcolor{keyword}{using\ }Receiver\ =\ std::unique\_ptr<ReceiverImpl<T>>;}
\DoxyCodeLine{00049\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>\ Receiver<T>\ MakeReceiver();}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{comment}{//\ -\/-\/-\/-\/\ Implementation\ part\ -\/-\/-\/-\/}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00055\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classftxui_1_1SenderImpl}{SenderImpl}}\ \{}
\DoxyCodeLine{00056\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordtype}{void}\ Send(T\ t)\ \{\ receiver\_-\/>Receive(std::move(t));\ \}}
\DoxyCodeLine{00058\ \ \ \string~SenderImpl()\ \{\ receiver\_-\/>ReleaseSender();\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ Sender<T>\ Clone()\ \{\ \textcolor{keywordflow}{return}\ receiver\_-\/>MakeSender();\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00063\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }ReceiverImpl<T>;}
\DoxyCodeLine{00064\ \ \ SenderImpl(ReceiverImpl<T>*\ consumer)\ :\ receiver\_(consumer)\ \{\}}
\DoxyCodeLine{00065\ \ \ ReceiverImpl<T>*\ receiver\_;}
\DoxyCodeLine{00066\ \};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00069\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classftxui_1_1ReceiverImpl}{ReceiverImpl}}\ \{}
\DoxyCodeLine{00070\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00071\ \ \ Sender<T>\ MakeSender()\ \{}
\DoxyCodeLine{00072\ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00073\ \ \ \ \ senders\_++;}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{return}\ std::unique\_ptr<SenderImpl<T>>(\textcolor{keyword}{new}\ SenderImpl<T>(\textcolor{keyword}{this}));}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ \ \ ReceiverImpl()\ \{\ senders\_\ =\ 0;\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{bool}\ Receive(T*\ t)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{while}\ (senders\_\ ||\ !queue\_.empty())\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (queue\_.empty())}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ notifier\_.wait(lock);}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (queue\_.empty())}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00085\ \ \ \ \ \ \ *t\ =\ std::move(queue\_.front());}
\DoxyCodeLine{00086\ \ \ \ \ \ \ queue\_.pop();}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordtype}{bool}\ ReceiveNonBlocking(T*\ t)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (queue\_.empty())}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00096\ \ \ \ \ *t\ =\ queue\_.front();}
\DoxyCodeLine{00097\ \ \ \ \ queue\_.pop();}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{bool}\ HasPending()\ \{}
\DoxyCodeLine{00102\ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{return}\ !queue\_.empty();}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \textcolor{keywordtype}{bool}\ HasQuitted()\ \{}
\DoxyCodeLine{00107\ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{return}\ queue\_.empty()\ \&\&\ !senders\_;}
\DoxyCodeLine{00109\ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00112\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }SenderImpl<T>;}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{keywordtype}{void}\ Receive(T\ t)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ lock(mutex\_);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ queue\_.push(std::move(t));}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ notifier\_.notify\_one();}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordtype}{void}\ ReleaseSender()\ \{}
\DoxyCodeLine{00123\ \ \ \ \ senders\_-\/-\/;}
\DoxyCodeLine{00124\ \ \ \ \ notifier\_.notify\_one();}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ std::mutex\ mutex\_;}
\DoxyCodeLine{00128\ \ \ std::queue<T>\ queue\_;}
\DoxyCodeLine{00129\ \ \ std::condition\_variable\ notifier\_;}
\DoxyCodeLine{00130\ \ \ std::atomic<int>\ senders\_;}
\DoxyCodeLine{00131\ \};}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00134\ Receiver<T>\ MakeReceiver()\ \{}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ std::make\_unique<ReceiverImpl<T>>();}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \}\ \ \textcolor{comment}{//\ namespace\ ftxui}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ FTXUI\_COMPONENT\_RECEIVER\_HPP\_}}

\end{DoxyCode}
